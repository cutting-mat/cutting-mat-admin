import{n as s,p as l,q as n}from"./index.ec256302.js";import"./ui.c0058d49.js";const r={data(){return{loading:!1,formData:{id:null,userInput:null,inputEmail:null},rules:{inputEmail:[{validator:(t,e,a)=>{if(!e)a(new Error("\u8BF7\u8F93\u5165\u5B89\u5168\u90AE\u7BB1"));else{if(this.userEmail&&this.userEmail!==e)return a(new Error("\u90AE\u7BB1\u4E0D\u6B63\u786E"));a()}},trigger:[]}],userInput:[{required:!0,message:"\u8BF7\u8F93\u5165\u9A8C\u8BC1\u7801",trigger:"blur"},{min:4,max:6,message:"\u8BF7\u8F93\u5165\u6B63\u786E\u7684\u9A8C\u8BC1\u7801",trigger:"blur"}]},buttonDisabled:!1}},computed:{userEmail(){return this.$store.user.email||""},anonymousEmail(){if(this.userEmail){const i=this.userEmail.split("@")[0].split("");return`${i.map((e,a)=>a===0||a===i.length-1?e:"*").join("")}@${this.userEmail.split("@")[1]}`}return""}},methods:{sendValidCode(){this.$refs.form.validateField("inputEmail",i=>{i||(this.loading=!0,l({email:this.formData.inputEmail}).then(t=>{this.loading=!1,t.status===200?(this.formData.id=t.data.id,this.$refs.countdownButton.start()):this.$message.warning("\u9A8C\u8BC1\u90AE\u4EF6\u53D1\u9001\u5931\u8D25\uFF0C\u8BF7\u7A0D\u540E\u91CD\u8BD5")}).catch(()=>{this.loading=!1}))})},handleSubmit(){this.$refs.form.validateField("userInput",i=>{i||(this.loading=!0,n(this.formData).then(t=>{this.loading=!1,t.status===200?this.$emit("success",t.data):(this.$refs.form.resetFields(),this.$message.warning("\u9A8C\u8BC1\u5931\u8D25"))}).catch(()=>{this.loading=!1}))})}}};var o=function(){var t=this,e=t._self._c;return e("el-form",{ref:"form",staticClass:"auth_email",attrs:{model:t.formData,rules:t.rules,"label-position":"left","v-loading":t.loading},nativeOn:{submit:function(a){return a.preventDefault(),t.handleSubmit.apply(null,arguments)}}},[t.anonymousEmail?e("el-form-item",[t._v("\u5B89\u5168\u90AE\u7BB1\uFF1A"+t._s(t.anonymousEmail))]):t._e(),e("el-form-item",{attrs:{prop:"inputEmail"}},[e("el-input",{attrs:{placeholder:"\u8BF7\u8F93\u5165\u5B89\u5168\u90AE\u7BB1","prefix-icon":"el-icon-message"},model:{value:t.formData.inputEmail,callback:function(a){t.$set(t.formData,"inputEmail",a)},expression:"formData.inputEmail"}})],1),e("el-form-item",{attrs:{prop:"userInput"}},[e("el-input",{attrs:{placeholder:"\u8BF7\u8F93\u5165\u9A8C\u8BC1\u7801"},model:{value:t.formData.userInput,callback:function(a){t.$set(t.formData,"userInput",a)},expression:"formData.userInput"}},[e("template",{slot:"append"},[e("el-button",{attrs:{disabled:t.buttonDisabled},on:{click:t.sendValidCode}},[e("CountDown",{ref:"countdownButton",attrs:{count:30},on:{start:function(a){t.buttonDisabled=!0},end:function(a){t.buttonDisabled=!1}}},[t._v(" \u83B7\u53D6\u9A8C\u8BC1\u7801 ")])],1)],1)],2)],1),e("el-form-item",[e("el-button",{staticStyle:{width:"100%"},attrs:{"native-type":"submit",type:"primary"}},[t._v(" \u7ACB\u5373\u9A8C\u8BC1 ")])],1)],1)},u=[],m=s(r,o,u,!1,null,"b3ba98bb",null,null);const p=m.exports;export{p as default};
